Microsoft (R) Macro Assembler Version 14.15.26730.0	    12/10/18 23:23:08
C:\Projects\REVIVAL\FDS\FILLERS\SclMMX32.asm		     Page 1 - 1


				.686
				.MMX
				.XMM
 00000000			_DATA   SEGMENT DWORD PUBLIC 'DATA'
				align 4
 00000000 00000000		du          dd  0
 00000004 00000000		Teax            dd  0
 00000008 00000000		StartX          dd  0
 0000000C 00000000		StartY          dd  0
 00000010 00000000		EndX            dd  0
 00000014 00000000		EndY            dd  0
 00000018 00000000		WidthX          dd  0
 0000001C 00000000		Height          dd  0
 00000020 00000000		ddx         dd  0
 00000024 00000000		ddy         dd  0
 00000028 00000000		Texture         dd  0
 0000002C 00000000		Screen          dd  0
 00000030 00000000		x           dd  0
 00000034 00000000		y           dd  0
 00000038 00000000		tx          dd  0
 0000003C 00000000		ty          dd  0
 00000040 00000000		ScanLine        dd  0
 00000044 00000000		ZScanLine        dd  0
 00000048 00000000		Counter         dd  0
 0000004C 00000000		TEBP            dd  0
 00000050 00000287		_Seven_UP_MMX_32_Size	dd	ASM_FILE_END - _Seven_UP_MMX_32_
				EXTRN           _XRes:dword
				EXTRN           _YRes:dword
				EXTRN           _VESA_BPSL:dword
				EXTRN           _PageSize:dword
				EXTRN           _BPP_Shift:dword
				align 1
 0054				_DATA   ENDS

 00000000			_TEXT   SEGMENT BYTE PUBLIC 'CODE'
					ASSUME  cs:_TEXT, ds:_DATA

					PUBLIC  _Seven_UP_MMX_32_Size

					PUBLIC  _Seven_UP_MMX_32_
 00000000			_Seven_UP_MMX_32_:
 00000000  89 2D 0000004C R	mov [TEBP],ebp
				;	eax = x ebx = y ecx = size x edx = size y esi = Texture edi = Screen Buffer
				;	on stack - RGB Color

 00000006  0F 6E 54 24 04	movd mm2, dword ptr [esp + 4]
 0000000B  0F EF C9		pxor mm1,mm1
 0000000E  0F 60 D1		PUNPCKLBW mm2,mm1
 00000011  83 F9 00		cmp ecx,0
 00000014  0F 8E 00000264	jle ScalerEnd
 0000001A  83 FA 00		cmp edx,0
 0000001D  0F 8E 0000025B	jle ScalerEnd
 00000023  89 35 00000028 R	mov [Texture],esi
 00000029  89 3D 0000002C R	mov [Screen],edi
 0000002F  8B 74 24 08		mov esi, [esp + 8]
				;mov ds:[ZConst], si
 00000033  8B F0		mov esi,eax
 00000035  8B FB		mov edi,ebx
 00000037  2B F1		sub esi,ecx
 00000039  2B FA		sub edi,edx
 0000003B  89 35 00000008 R	mov [StartX],esi
 00000041  89 3D 0000000C R	mov [StartY],edi
 00000047  03 C1		add eax,ecx
 00000049  03 DA		add ebx,edx
 0000004B  A3 00000010 R	mov [EndX],eax
 00000050  89 1D 00000014 R	mov [EndY],ebx
 00000056  2B C6		sub eax,esi
 00000058  2B DF		sub ebx,edi
 0000005A  A3 00000018 R	mov [WidthX],eax
 0000005F  89 1D 0000001C R	mov [Height],ebx
 00000065  8B C8		mov ecx,eax
 00000067  8B EB		mov ebp,ebx
				;mov eax,10000000h
 00000069  B8 02000000		mov eax,02000000h
 0000006E  BA 00000000		mov edx,0
 00000073  F7 F1		div ecx
 00000075  A3 00000020 R	mov [ddx],eax
				;mov eax,10000000h
 0000007A  B8 02000000		mov eax,02000000h
 0000007F  BA 00000000		mov edx,0
 00000084  F7 F5		div ebp
 00000086  A3 00000024 R	mov [ddy],eax
 0000008B  A1 00000008 R	mov eax,[StartX]
 00000090  8B 1D 0000000C R	mov ebx,[StartY]
 00000096  83 F8 00		cmp eax,0
 00000099  7D 34		jge @@StartXOverZero
 0000009B  8B 2D 00000018 R	mov ebp,[WidthX]
 000000A1  B8 00000000		mov eax,0
 000000A6  8B 0D 00000008 R	mov ecx,[StartX]
 000000AC  C7 05 00000030 R	mov [x],0
	   00000000
 000000B6  03 E9		add ebp,ecx
 000000B8  2B C1		sub eax,ecx
 000000BA  89 2D 00000018 R	mov [WidthX],ebp
 000000C0  8B 0D 00000020 R	mov ecx,[ddx]
 000000C6  F7 E1		mul ecx
 000000C8  A3 00000038 R	mov [tx],eax
 000000CD  EB 0F		jmp @@CheckY
 000000CF			@@StartXOverZero:
 000000CF  A3 00000030 R	mov [x],eax
 000000D4  C7 05 00000038 R	mov [tx],0
	   00000000
 000000DE			@@CheckY:
 000000DE  83 FB 00		cmp ebx,0
 000000E1  7D 34		jge @@StartYOverZero
 000000E3  8B 2D 0000001C R	mov ebp,[Height]
 000000E9  B8 00000000		mov eax,0
 000000EE  8B 0D 0000000C R	mov ecx,[StartY]
 000000F4  C7 05 00000034 R	mov [y],0
	   00000000
 000000FE  03 E9		add ebp,ecx
 00000100  2B C1		sub eax,ecx
 00000102  89 2D 0000001C R	mov [Height],ebp
 00000108  8B 0D 00000024 R	mov ecx,[ddy]
 0000010E  F7 E1		mul ecx
 00000110  A3 0000003C R	mov [ty],eax
 00000115  EB 10		jmp @@CheckEndX
 00000117			@@StartYOverZero:
 00000117  89 1D 00000034 R	mov [y],ebx
 0000011D  C7 05 0000003C R	mov [ty],0
	   00000000
 00000127			@@CheckEndX:
 00000127  A1 00000010 R	mov eax,[EndX]
 0000012C  8B 1D 00000014 R	mov ebx,[EndY]
 00000132  3B 05 00000000 E	cmp eax,[_XRes]
 00000138  7C 19		jl @@CheckEndY
 0000013A  A1 00000000 E	mov eax,[_XRes]
 0000013F  2B 05 00000030 R	sub eax,[x]
 00000145  A3 00000018 R	mov [WidthX],eax
 0000014A  83 F8 00		cmp eax,0
 0000014D  0F 8E 0000012B	jle ScalerEnd
 00000153			@@CheckEndY:

 00000153  3B 1D 00000000 E	cmp ebx,[_YRes]
 00000159  7C 10		jl @@Setup
 0000015B  A1 00000000 E	mov eax,[_YRes]
 00000160  2B 05 00000034 R	sub eax,[y]
 00000166  A3 0000001C R	mov [Height],eax
 0000016B			@@Setup:
 0000016B  83 3D 00000018 R	cmp [WidthX],0
	   00
 00000172  0F 8E 00000106	jle ScalerEnd
 00000178  83 3D 0000001C R	cmp [Height],0
	   00
 0000017F  0F 8E 000000F9	jle ScalerEnd

 00000185  A1 00000034 R	mov eax,[y]
 0000018A  8B 1D 00000030 R	mov ebx,[x]
 00000190  F7 25 00000000 E	mul [_XRes]
 00000196  03 D8		add ebx,eax
 00000198  8B D3		mov edx, ebx
 0000019A  8B 0D 00000000 E	mov ecx,[_BPP_Shift]
 000001A0  D3 E3		shl ebx,cl
 000001A2  D1 E2		shl edx, 1
 000001A4  8B CB		mov ecx,ebx
 000001A6  A1 0000002C R	mov eax,[Screen]
 000001AB  03 D8		add ebx,eax
 000001AD  03 D0		add edx,eax
 000001AF  03 15 00000000 E	add edx, [_PageSize]
 000001B5  89 1D 00000040 R	mov [ScanLine],ebx
 000001BB  89 15 00000044 R	mov [ZScanLine],edx
 000001C1			@@Outer:
 000001C1  A1 0000003C R	mov eax,[ty]
 000001C6  8B 1D 00000020 R	mov ebx,[ddx]
 000001CC  8B 3D 00000040 R	mov edi,[ScanLine]
 000001D2  C1 CB 14		ror ebx,20
 000001D5  25 0FF00000		and eax,0ff00000h
 000001DA  8A CB		mov cl,bl
 000001DC  C1 E8 0F		shr eax,15
 000001DF  B3 00		mov bl,0
 000001E1  8B 15 00000038 R	mov edx,[tx]
				;mov [du],ebx
 000001E7  C1 CA 14		ror edx,20
 000001EA  8B 35 00000018 R	mov esi,[WidthX]
				;add eax,[Texture]
				;shl esi,2
 000001F0  8B 2D 00000028 R	mov ebp,[Texture]
 000001F6  80 E2 1F		and dl,01fh
 000001F9  24 E0		and al,0E0h
 000001FB  0A C2		or  al,dl
 000001FD  8D 3C B7		lea edi,[edi+esi*4]
 00000200  8A D1		mov dl,cl
 00000202  8B 0D 00000044 R	mov ecx, [ZScanLine]
 00000208  8D 0C 71		lea ecx, [ecx+esi*2]

				; neg esi
 0000020B  83 F6 FF		xor esi,-1
 0000020E  46			inc esi

 0000020F			@@inner:
					;cmp [ecx + esi * 2], ZConst
				;	db 066h, 081h, 03Ch, 071h
				;	ZConst dw 0
				;	ja @no_draw

				;	movd mm0,[ebp+eax*4]
				;	paddusb mm0,[edi+esi*4]
				;	movd [edi+esi*4],mm0

 0000020F  0F 60 44 85 00		punpcklbw mm0,[ebp+eax*4]
 00000214  0F 71 D0 08			psrlw mm0,8
 00000218  0F D5 C2			pmullw mm0,mm2
 0000021B  0F 71 D0 08			psrlw mm0, 8
 0000021F  0F 67 C0			packuswb mm0, mm0
 00000222  0F 6E 0C B7			movd mm1, dword ptr [edi+esi * 4]
 00000226  0F DC C1			paddusb mm0, mm1
 00000229  0F 7E 04 B7			movd dword ptr [edi + esi * 4],mm0
				; @no_draw:
 0000022D  03 D3			add edx,ebx
 0000022F  12 C2			adc al,dl
 00000231  46				inc esi
 00000232  75 DB		jnz @@inner
 00000234  A1 00000040 R	mov eax,[ScanLine]
 00000239  8B 1D 0000003C R	mov ebx,[ty]
 0000023F  03 05 00000000 E	add eax,[_VESA_BPSL]
 00000245  8B 0D 00000024 R	mov ecx,[ddy]
 0000024B  8B 15 0000001C R	mov edx,[height]
 00000251  03 D9		add ebx,ecx
 00000253  4A			dec edx
 00000254  89 1D 0000003C R	mov [ty],ebx
 0000025A  A3 00000040 R	mov [ScanLine],eax
 0000025F  89 15 0000001C R	mov [height],edx

 00000265  A1 00000044 R	mov eax, [ZScanLine]
 0000026A  8B 1D 00000000 E	mov ebx, [_XRes]
 00000270  8D 04 58		lea eax, [eax+ebx*2]
 00000273  A3 00000044 R	mov [ZScanLine], eax

 00000278  0F 85 FFFFFF43	jnz @@Outer

 0000027E			ScalerEnd:
 0000027E  8B 2D 0000004C R	mov ebp,[TEBP]
 00000284  0F 77		emms
 00000286  C3			ret

 00000287 = 00000287		ASM_FILE_END	equ	$

 0287				_TEXT   ENDS

				END

Microsoft (R) Macro Assembler Version 14.15.26730.0	    12/10/18 23:23:08
C:\Projects\REVIVAL\FDS\FILLERS\SclMMX32.asm		     Symbols 2 - 1




Segments and Groups:

                N a m e                 Size     Length   Align   Combine Class

_DATA  . . . . . . . . . . . . .	32 Bit	 0054	  DWord	  Public  'DATA'	
_TEXT  . . . . . . . . . . . . .	32 Bit	 0287	  Byte	  Public  'CODE'	


Symbols:

                N a m e                 Type     Value    Attr

@@CheckEndX  . . . . . . . . . .	L Near	 0127	  _TEXT	
@@CheckEndY  . . . . . . . . . .	L Near	 0153	  _TEXT	
@@CheckY . . . . . . . . . . . .	L Near	 00DE	  _TEXT	
@@Outer  . . . . . . . . . . . .	L Near	 01C1	  _TEXT	
@@Setup  . . . . . . . . . . . .	L Near	 016B	  _TEXT	
@@StartXOverZero . . . . . . . .	L Near	 00CF	  _TEXT	
@@StartYOverZero . . . . . . . .	L Near	 0117	  _TEXT	
@@inner  . . . . . . . . . . . .	L Near	 020F	  _TEXT	
ASM_FILE_END . . . . . . . . . .	Number	 0287h	 
Counter  . . . . . . . . . . . .	DWord	 0048	  _DATA	
EndX . . . . . . . . . . . . . .	DWord	 0010	  _DATA	
EndY . . . . . . . . . . . . . .	DWord	 0014	  _DATA	
Height . . . . . . . . . . . . .	DWord	 001C	  _DATA	
ScalerEnd  . . . . . . . . . . .	L Near	 027E	  _TEXT	
ScanLine . . . . . . . . . . . .	DWord	 0040	  _DATA	
Screen . . . . . . . . . . . . .	DWord	 002C	  _DATA	
StartX . . . . . . . . . . . . .	DWord	 0008	  _DATA	
StartY . . . . . . . . . . . . .	DWord	 000C	  _DATA	
TEBP . . . . . . . . . . . . . .	DWord	 004C	  _DATA	
Teax . . . . . . . . . . . . . .	DWord	 0004	  _DATA	
Texture  . . . . . . . . . . . .	DWord	 0028	  _DATA	
WidthX . . . . . . . . . . . . .	DWord	 0018	  _DATA	
ZScanLine  . . . . . . . . . . .	DWord	 0044	  _DATA	
_BPP_Shift . . . . . . . . . . .	DWord	 0000	  _DATA	External
_PageSize  . . . . . . . . . . .	DWord	 0000	  _DATA	External
_Seven_UP_MMX_32_Size  . . . . .	DWord	 0050	  _DATA	Public
_Seven_UP_MMX_32_  . . . . . . .	L Near	 0000	  _TEXT	Public
_VESA_BPSL . . . . . . . . . . .	DWord	 0000	  _DATA	External
_XRes  . . . . . . . . . . . . .	DWord	 0000	  _DATA	External
_YRes  . . . . . . . . . . . . .	DWord	 0000	  _DATA	External
ddx  . . . . . . . . . . . . . .	DWord	 0020	  _DATA	
ddy  . . . . . . . . . . . . . .	DWord	 0024	  _DATA	
du . . . . . . . . . . . . . . .	DWord	 0000	  _DATA	
tx . . . . . . . . . . . . . . .	DWord	 0038	  _DATA	
ty . . . . . . . . . . . . . . .	DWord	 003C	  _DATA	
x  . . . . . . . . . . . . . . .	DWord	 0030	  _DATA	
y  . . . . . . . . . . . . . . .	DWord	 0034	  _DATA	

	   0 Warnings
	   0 Errors
